{% extends "base.html" %}

{% block title %}Planejamento FRZ{% endblock %}

{% block content %}
<div class="frz-page">
<div class="dashboard-header fade-in-up frz-compact-header">
    <div class="frz-header-container">
        <div class="frz-filters">
            <label for="mes">Mês:</label>
            <select id="mes" name="mes" class="frz-select">
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Março</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9" selected>Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
            </select>
            
            <label for="ano">Ano:</label>
            <select id="ano" name="ano" class="frz-select">
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026">2026</option>
                <option value="2027">2027</option>
            </select>
            
            <button onclick="atualizarPlanejamento()" class="frz-btn-atualizar">Atualizar</button>
        </div>
    </div>
</div>

<div class="frz-table-container">
    <table class="frz-planning-table">
        <thead>
            <tr class="header-row">
                <th class="cliente-col">Clientes</th>
                <th colspan="2" class="semana-header">{{ dados.semanas[0].label }}</th>
                <th colspan="2" class="semana-header">{{ dados.semanas[1].label }}</th>
                <th colspan="2" class="semana-header">{{ dados.semanas[2].label }}</th>
                <th colspan="2" class="semana-header">{{ dados.semanas[3].label }}</th>
                <th colspan="2" class="semana-header">{{ dados.semanas[4].label }}</th>
                <th colspan="2" class="total-header">TOTAL MÊS</th>
            </tr>
            <tr class="subheader-row">
                <th></th>
                <th class="proj-real">PROJETADO</th>
                <th class="proj-real">REALIZADO</th>
                <th class="proj-real">PROJETADO</th>
                <th class="proj-real">REALIZADO</th>
                <th class="proj-real">PROJETADO</th>
                <th class="proj-real">REALIZADO</th>
                <th class="proj-real">PROJETADO</th>
                <th class="proj-real">REALIZADO</th>
                <th class="proj-real">PROJETADO</th>
                <th class="proj-real">REALIZADO</th>
                <th class="proj-real">PROJETADO</th>
                <th class="proj-real">REALIZADO</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente in dados.clientes %}
            <tr>
                <td class="cliente-nome">{{ cliente }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_1.projetado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_1.realizado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_2.projetado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_2.realizado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_3.projetado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_3.realizado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_4.projetado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_4.realizado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_5.projetado) }}</td>
                <td class="valor">R$ {{ "{:,.2f}".format(dados.clientes[cliente].semana_5.realizado) }}</td>
                <td class="valor total-col">R$ {{ "{:,.2f}".format(dados.clientes[cliente].total_mes.projetado) }}</td>
                <td class="valor total-col">R$ {{ "{:,.2f}".format(dados.clientes[cliente].total_mes.realizado) }}</td>
            </tr>
            {% endfor %}
            
            <tr class="total-row">
                <td class="cliente-nome total-label">TOTAL</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_1.projetado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_1.realizado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_2.projetado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_2.realizado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_3.projetado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_3.realizado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_4.projetado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_4.realizado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_5.projetado) }}</td>
                <td class="valor total-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_5.realizado) }}</td>
                <td class="valor total-col total-valor">R$ {{ "{:,.2f}".format(dados.totais.total_geral.projetado) }}</td>
                <td class="valor total-col total-valor">R$ {{ "{:,.2f}".format(dados.totais.total_geral.realizado) }}</td>
            </tr>
            
            <tr class="despesas-row">
                <td class="cliente-nome despesas-label">Despesas gerais</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_1.projetado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_1.realizado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_2.projetado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_2.realizado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_3.projetado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_3.realizado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_4.projetado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_4.realizado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_5.projetado) }}</td>
                <td class="valor despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_semanas.semana_5.realizado) }}</td>
                <td class="valor total-col despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_gerais.projetado) }}</td>
                <td class="valor total-col despesas-valor">R$ {{ "{:,.2f}".format(dados.totais.despesas_gerais.realizado) }}</td>
            </tr>
            
            <tr class="resultado-row">
                <td class="cliente-nome resultado-label">Resultado</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_1.projetado - dados.totais.despesas_semanas.semana_1.projetado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_1.realizado - dados.totais.despesas_semanas.semana_1.realizado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_2.projetado - dados.totais.despesas_semanas.semana_2.projetado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_2.realizado - dados.totais.despesas_semanas.semana_2.realizado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_3.projetado - dados.totais.despesas_semanas.semana_3.projetado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_3.realizado - dados.totais.despesas_semanas.semana_3.realizado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_4.projetado - dados.totais.despesas_semanas.semana_4.projetado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_4.realizado - dados.totais.despesas_semanas.semana_4.realizado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_5.projetado - dados.totais.despesas_semanas.semana_5.projetado) }}</td>
                <td class="valor resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.semanas.semana_5.realizado - dados.totais.despesas_semanas.semana_5.realizado) }}</td>
                <td class="valor total-col resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.resultado.projetado) }}</td>
                <td class="valor total-col resultado-valor">R$ {{ "{:,.2f}".format(dados.totais.resultado.realizado) }}</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
function atualizarPlanejamento() {
    const mes = document.getElementById('mes').value;
    const ano = document.getElementById('ano').value;
    console.log('Atualizando planejamento para:', mes, '/', ano);
    
    // Redirecionar para a mesma página com os novos parâmetros
    window.location.href = `/planejamento_frz?mes=${mes}&ano=${ano}`;
}

// Configurar valores padrão dos selects com os valores atuais
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const mesAtual = urlParams.get('mes') || new Date().getMonth() + 1;
    const anoAtual = urlParams.get('ano') || new Date().getFullYear();
    
    document.getElementById('mes').value = mesAtual;
    document.getElementById('ano').value = anoAtual;
});
</script>
</div>
{% endblock %}