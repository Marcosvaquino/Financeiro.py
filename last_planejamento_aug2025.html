<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Financeiro</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <button id="sidebarClose" class="sidebar-close" aria-label="Fechar menu">‹</button>
        <h2 class="sidebar-title">Menu</h2>
        <ul>
            <li><a href="/planejamento">Painel</a></li>
            <li><a href="/projecao">Projeção</a></li>
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="/resumo">Resumo</a></li>
            <li><a href="/consolidacao">Consolidação</a></li>
            <li><a href="/importacao">📂 Importação</a></li>
        </ul>
    </div>

    <!-- botão fixo para abrir quando o menu estiver fechado -->
    <button id="sidebarOpen" class="sidebar-open" aria-label="Abrir menu">›</button>

    <div class="content">
        
<div class="dashboard-header fade-in-up">
    <h1>💼 Painel Financeiro Mensal</h1>
    <div class="subtitle">Dashboard inteligente para o Painel financeiro</div>
</div>

<!-- Filtros de Mês e Ano -->
<div class="filters-container fade-in-up">
    <form method="GET" action="/planejamento" class="filters-form">
        <div class="filter-group">
            <label for="mes">Mês:</label>
            <select name="mes" id="mes" onchange="this.form.submit()">
                <option value="">Todos</option>
                
                    <option value="01" >
                        Janeiro
                    </option>
                
                    <option value="02" >
                        Fevereiro
                    </option>
                
                    <option value="03" >
                        Março
                    </option>
                
                    <option value="04" >
                        Abril
                    </option>
                
                    <option value="05" >
                        Maio
                    </option>
                
                    <option value="06" >
                        Junho
                    </option>
                
                    <option value="07" >
                        Julho
                    </option>
                
                    <option value="08" selected>
                        Agosto
                    </option>
                
                    <option value="09" >
                        Setembro
                    </option>
                
                    <option value="10" >
                        Outubro
                    </option>
                
                    <option value="11" >
                        Novembro
                    </option>
                
                    <option value="12" >
                        Dezembro
                    </option>
                
            </select>
        </div>
        <div class="filter-group">
            <label for="ano">Ano:</label>
            <select name="ano" id="ano" onchange="this.form.submit()">
                <option value="">Todos</option>
                <option value="2024" >2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026" >2026</option>
            </select>
        </div>
    </form>
</div>

<!-- Cards de Estatísticas -->
<div class="stats-grid fade-in-up">
    <div class="stat-card">
        <div class="stat-number">R$ 0,00</div>
        <div class="stat-label">Total a Receber</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">R$ 0,00</div>
        <div class="stat-label">Total a Pagar</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">R$ 0,00</div>
        <div class="stat-label">Saldo Projetado</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">0</div>
        <div class="stat-label">Lançamentos</div>
    </div>
</div>

<!-- Cards Principais -->
<div class="cards-container fade-in-up">
    <!-- Card de Resumo -->
    <div class="card card-primary">
        <div class="card-header">
            <div class="card-title">Resumo do Mês</div>
            <div class="card-icon">📊</div>
        </div>
        <div class="card-value">R$ 0,00</div>
        <div class="card-subtitle">Saldo projetado atual</div>
        <div class="card-progress">
            <div class="card-progress-bar" data-width="25"></div>
        </div>
    </div>

    <!-- Card de Contas a Receber -->
    <div class="card card-success">
        <div class="card-header">
            <div class="card-title">Contas a Receber</div>
            <div class="card-icon">💰</div>
        </div>
        <div class="card-value">R$ 0,00</div>
        <div class="card-subtitle">Valor Projeção: R$ 100000,00</div>
        <div class="card-progress">
            
            <div class="card-progress-bar" style="width: 0.0%"></div>
            <div class="card-progress-text">0.0%</div>
        </div>
    </div>

    <!-- Card de Contas a Pagar -->
    <div class="card card-warning">
        <div class="card-header">
            <div class="card-title">Contas a Pagar</div>
            <div class="card-icon">💸</div>
        </div>
        <div class="card-value">R$ 0,00</div>
        <div class="card-subtitle">Obrigações pendentes</div>
        <div class="card-progress">
            <div class="card-progress-bar" style="width: 85%"></div>
        </div>
    </div>

    <!-- Card de Alertas -->
    <div class="card card-danger">
        <div class="card-header">
            <div class="card-title">Alertas</div>
            <div class="card-icon">⚠️</div>
        </div>
        <div class="card-value">0</div>
        <div class="card-subtitle">Vencimentos próximos</div>
        <div class="card-progress">
            <div class="card-progress-bar" data-width="25"></div>
        </div>
    </div>
</div>

<!-- Tabela Dinâmica -->
<div class="table-container slide-in-left">
    <div class="table-header">
        <div class="table-title">📋 Lançamentos Financeiros</div>
        <div class="table-controls">
            <input type="text" class="search-box" placeholder="Buscar lançamentos..." id="searchInput">
            <select class="filter-select" id="statusFilter">
                <option value="">Todos os Status</option>
                <option value="pending">Pendente</option>
                <option value="paid">Pago</option>
                <option value="overdue">Vencido</option>
            </select>
            <select class="filter-select" id="monthFilter">
                <option value="">Todos os Meses</option>
                <option value="janeiro">Janeiro</option>
                <option value="fevereiro">Fevereiro</option>
                <option value="março">Março</option>
            </select>
        </div>
    </div>
    
    <table class="dynamic-table" id="financialTable">
        <thead>
            <tr>
                <th class="sortable" data-column="cliente">Cliente/Fornecedor</th>
                <th class="sortable" data-column="valor">Valor</th>
                <th class="sortable" data-column="vencimento">Vencimento</th>
                <th class="sortable" data-column="status">Status</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            
                <tr>
                    <td colspan="5" style="text-align: center; padding: 40px; color: #64748b;">
                        📊 Nenhum lançamento encontrado. Importe seus dados financeiros na seção de Importação.
                    </td>
                </tr>
            
        </tbody>
    </table>
</div>

<!-- JavaScript para interatividade -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Funcionalidade de busca
    const searchInput = document.getElementById('searchInput');
    const table = document.getElementById('financialTable');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    searchInput.addEventListener('keyup', function() {
        const filter = this.value.toLowerCase();
        
        for (let i = 0; i < rows.length; i++) {
            const row = rows[i];
            const text = row.textContent.toLowerCase();
            
            if (text.includes(filter)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        }
    });

    // Funcionalidade de ordenação
    const sortableHeaders = document.querySelectorAll('th.sortable');
    let sortDirection = 1;

    sortableHeaders.forEach(header => {
        header.addEventListener('click', function() {
            const column = this.dataset.column;
            sortTable(column);
            
            // Atualiza visual da ordenação
            sortableHeaders.forEach(h => h.classList.remove('sort-asc', 'sort-desc'));
            this.classList.add(sortDirection === 1 ? 'sort-asc' : 'sort-desc');
            sortDirection *= -1;
        });
    });

    function sortTable(column) {
        const tbody = table.getElementsByTagName('tbody')[0];
        const rowsArray = Array.from(tbody.getElementsByTagName('tr'));
        
        rowsArray.sort((a, b) => {
            let aValue, bValue;
            
            switch(column) {
                case 'cliente':
                    aValue = a.cells[0].textContent;
                    bValue = b.cells[0].textContent;
                    break;
                case 'valor':
                    aValue = parseFloat(a.cells[1].textContent.replace(/[^\d,]/g, '').replace(',', '.'));
                    bValue = parseFloat(b.cells[1].textContent.replace(/[^\d,]/g, '').replace(',', '.'));
                    break;
                case 'vencimento':
                    aValue = new Date(a.cells[2].textContent.split('/').reverse().join('-'));
                    bValue = new Date(b.cells[2].textContent.split('/').reverse().join('-'));
                    break;
                case 'status':
                    aValue = a.cells[3].textContent;
                    bValue = b.cells[3].textContent;
                    break;
            }
            
            if (aValue < bValue) return -sortDirection;
            if (aValue > bValue) return sortDirection;
            return 0;
        });
        
        // Reinsere as linhas ordenadas
        rowsArray.forEach(row => tbody.appendChild(row));
    }

    // Filtros de status
    const statusFilter = document.getElementById('statusFilter');
    statusFilter.addEventListener('change', function() {
        const filterValue = this.value;
        
        for (let i = 0; i < rows.length; i++) {
            const row = rows[i];
            const statusBadge = row.querySelector('.status-badge');
            
            if (!filterValue || statusBadge.classList.contains(filterValue)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        }
    });

    // Animação de entrada dos cards
    const cards = document.querySelectorAll('.card, .stat-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>

<style>
/* Animações iniciais */
.card, .stat-card {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.6s ease-out;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 12px;
    margin-right: 5px;
}
</style>

<script>
// set widths from data-width attributes to avoid Jinja in inline CSS
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[data-width]').forEach(el => {
        const w = el.getAttribute('data-width');
        if (w !== null) el.style.width = w + '%';
    });
});
</script>


    </div>
    <script>
        // Simple sidebar toggle: adiciona/removes a classe 'collapsed'
        (function(){
            const btnClose = document.getElementById('sidebarClose');
            const btnOpen = document.getElementById('sidebarOpen');
            const sidebar = document.getElementById('sidebar');
            if(!sidebar) return;

            // helper to hide/show controls
            function setClosed(){
                sidebar.classList.add('collapsed');
                if(btnClose) btnClose.style.display = 'none';
                if(btnOpen) btnOpen.style.display = 'block';
            }
            function setOpen(){
                sidebar.classList.remove('collapsed');
                if(btnClose) btnClose.style.display = 'block';
                if(btnOpen) btnOpen.style.display = 'none';
            }

            // wire up buttons
            if(btnClose){
                btnClose.addEventListener('click', function(e){
                    setClosed();
                    e.stopPropagation();
                });
            }
            if(btnOpen){
                btnOpen.addEventListener('click', function(e){
                    setOpen();
                    e.stopPropagation();
                });
            }

            // initialize based on current class
            if(sidebar.classList.contains('collapsed')){
                if(btnClose) btnClose.style.display = 'none';
                if(btnOpen) btnOpen.style.display = 'block';
            } else {
                if(btnClose) btnClose.style.display = 'block';
                if(btnOpen) btnOpen.style.display = 'none';
            }
        })();
    </script>
</body>
</html>
